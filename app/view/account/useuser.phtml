<?php
$list = $this->view->list ?? [];

$this->load( $this->getViewPath() . "header.phtml" );
?>

<div class="container py-4">
  <h1 class="h5 mb-3">再生ログ一覧</h1>

  <?php if (empty($list)): ?>
    <div class="alert alert-info">表示できるデータがありません。</div>
  <?php else: ?>
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th style="width:120px;">ID</th>
            <th>名前</th>
            <th class="text-end" style="width:120px;">再生数</th>
            <th class="text-nowrap" style="width:200px;">最後に表示</th>
          </tr>
        </thead>
        <tbody>
          <?php foreach ($list as $row): ?>
            <?php
              // セーフティに取り出し＆エスケープ
              $id   = htmlspecialchars($row['id']   ?? ($row['target_id'] ?? ''), ENT_QUOTES, 'UTF-8');
              $name = htmlspecialchars($row['name'] ?? '', ENT_QUOTES, 'UTF-8');
              $cnt  = (int)($row['cnt'] ?? 0);
              $last = htmlspecialchars($row['last'] ?? '', ENT_QUOTES, 'UTF-8');
            ?>
            <tr>
              <td><?= $id ?></td>
              <td><?= $name !== '' ? $name : '<span class="text-muted">（名無し）</span>' ?></td>
              <td class="text-end"><?= number_format($cnt) ?></td>
              <td class="text-nowrap"><?= $last !== '' ? $last : '<span class="text-muted">—</span>' ?></td>
            </tr>
          <?php endforeach; ?>
        </tbody>
      </table>
    </div>
  <?php endif; ?>
</div>

<?php
$this->load( $this->getViewPath() . "footer.phtml" );
?>
